# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Frontend –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ localhost –≤–º–µ—Å—Ç–æ VM

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `deploy-vm.sh` –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `http://localhost:3001/api` –≤–º–µ—Å—Ç–æ `http://87.242.103.146/api`.

## –ü—Ä–∏—á–∏–Ω–∞

–í —Ñ–∞–π–ª–µ [frontend/src/api/client.ts](frontend/src/api/client.ts) –±—ã–ª–∞ –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö API —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞. –≠—Ç–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–ª–∞:

1. `http://localhost:3001/api` (–ø–µ—Ä–≤—ã–º)
2. `http://87.242.103.146/api` (–≤—Ç–æ—Ä—ã–º)

–ò –≤—ã–±–∏—Ä–∞–ª–∞ –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Å–µ—Ä–≤–µ—Ä. –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π backend –±—ã–ª –∑–∞–ø—É—â–µ–Ω, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–¥–∫–ª—é—á–∞–ª—Å—è –∫ –Ω–µ–º—É –¥–∞–∂–µ –≤ production —Ä–µ–∂–∏–º–µ.

## –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `frontend/src/api/client.ts`:

#### 1. –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API URL –¥–ª—è production

```typescript
// –í production –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º VITE_API_URL, –±–µ–∑ fallback –ø—Ä–æ–≤–µ—Ä–æ–∫
let currentApiUrl: string = import.meta.env.MODE === 'production'
  ? (import.meta.env.VITE_API_URL || 'http://87.242.103.146/api')
  : API_SERVERS[0];
```

#### 2. –û—Ç–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ production

```typescript
async function initializeApiClient(): Promise<AxiosInstance> {
  // –í production –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ä–≤–µ—Ä—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–¥–∞–Ω–Ω—ã–π URL –Ω–∞–ø—Ä—è–º—É—é
  if (import.meta.env.MODE === 'production') {
    currentApiUrl = import.meta.env.VITE_API_URL || 'http://87.242.103.146/api';
    console.log(`üîß Production mode: using fixed API URL: ${currentApiUrl}`);
  } else {
    currentApiUrl = await findWorkingServer();
  }
  const client = createApiClient(currentApiUrl);
  // ...
}
```

#### 3. –û—Ç–∫–ª—é—á–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ production

```typescript
// –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –ø–æ–ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è (—Ç–æ–ª—å–∫–æ –≤ dev —Ä–µ–∂–∏–º–µ)
if (import.meta.env.MODE !== 'production' && !error.response && ...) {
  // –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤
}
```

## –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ frontend)

```bash
cd /home/maxim/RentAdmin
./quick-frontend-update.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç frontend —Å production –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç nginx
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
cd /home/maxim/RentAdmin
./deploy-vm.sh
```

–ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –∏ backend, –∏ frontend.

## –ü—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API URL –≤ —Å–æ–±—Ä–∞–Ω–Ω–æ–º —Ñ–∞–π–ª–µ

```bash
grep -o "http://[^\"']*" frontend/dist/assets/index-*.js | grep api
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: `http://87.242.103.146/api`

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://87.242.103.146
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console
4. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: `üîß Production mode: using fixed API URL: http://87.242.103.146/api`

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network –∑–∞–ø—Ä–æ—Å—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5)
3. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/*` –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ –Ω–∞ `http://87.242.103.146/api/...`

## –í–∞–∂–Ω–æ

- **Development —Ä–µ–∂–∏–º** (`npm run dev`): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ (localhost ‚Üí VM)
- **Production —Ä–µ–∂–∏–º** (`npm run build`): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π URL –∏–∑ `.env.production`

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### `.env.production`

```env
VITE_API_URL=http://87.242.103.146/api
```

–≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç API URL –¥–ª—è production —Å–±–æ—Ä–∫–∏.

### `.env.development` (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```env
VITE_API_URL=http://localhost:3001/api
```

## –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

| –†–µ–∂–∏–º | –ö–æ–º–∞–Ω–¥–∞ | API URL | –ê–≤—Ç–æ–ø–æ–∏—Å–∫ |
|-------|---------|---------|-----------|
| Development | `npm run dev` | localhost:3001 ‚Üí VM | ‚úÖ –î–∞ |
| Production | `npm run build` | –ò–∑ VITE_API_URL | ‚ùå –ù–µ—Ç |

## Troubleshooting

### Frontend –≤—Å–µ –µ—â–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ localhost

1. **–û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞**: Ctrl+F5 –∏–ª–∏ Ctrl+Shift+Delete
2. **–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ frontend**: `./quick-frontend-update.sh`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∂–∏–º —Å–±–æ—Ä–∫–∏**: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `production`, –Ω–µ `development`

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∂–∏–º —Å–±–æ—Ä–∫–∏

```bash
cat frontend/dist/assets/index-*.js | grep "Production mode"
```

–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ, –∑–Ω–∞—á–∏—Ç —Å–æ–±—Ä–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

### Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ VM

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend
curl http://87.242.103.146/api/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
lsof -i :3001

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
./deploy-vm.sh
```

## –°–∫—Ä–∏–ø—Ç—ã

| –°–∫—Ä–∏–ø—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `./deploy-vm.sh` | –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (backend + frontend) |
| `./quick-frontend-update.sh` | –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ frontend |
| `./stop-vm.sh` | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ |

## –°–º. —Ç–∞–∫–∂–µ

- [DEPLOY.md](DEPLOY.md) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- [SCRIPTS.md](SCRIPTS.md) - –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
- [VM-STOP-INSTRUCTIONS.md](VM-STOP-INSTRUCTIONS.md) - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
